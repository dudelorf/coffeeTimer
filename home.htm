<!DOCTYPE hmtl>
<head>
	<title>Login</title>
	<link rel="stylesheet" type="text/css" href="styles/login.css" />
	<script src="http://ajax.googleapis.com/ajax/libs/jquery/1.11.2/jquery.min.js"></script>
</head>
<body>
	<div id="container">
		<div id="controls">
			<p>Coffee Brewing</p>
		</div>
		
		<h2>Login to brew some coffee</h2>
		
		<form id="loginForm" action="php_scripts/loginScript.php" method="post">
            <table>
                <tbody>
                <tr><td>
                    <input id="usernameField" type="text" size="15" maxlength="20" />
                    <label for="usernameField">User name</label>
                </td></tr>
                <tr><td>
                    <input id="passwordField" type="password" size="15" maxlength="20"/>
                    <label for="passwordField">Password</label>
                </td></tr>
                <tr id="verifyPasswordField" style="opacity:0"><td>
                    <input id="passwordVerify" type="password" size="15" maxlength="20" />
                    <label for="passwordVerify" >Verify password</label>
                </td></tr>
                </tbody>
            </table>
		</form>
		<table>
        <tr><td>
            <div id="login" class="pageButton">
                <p>Login</p>
            </div>
            <div id="cancel" class="pageButton" style="display:none">
                <p>Cancel</p>
            </div>
        </td>
        <td>
            <div id="newAccount" class="pageButton">
                <p>Register Account</p>
            </div>
        </td></tr>
        </table>
	</div>
	<script type="text/javascript">
		$(document).ready(function() {
            $("#login").click(function () {
                $.post("php_scripts/loginScript.php",
                        {
                            userName: $("#usernameField").val(),
                            userPassword: $("#passwordField").val()
                        },
                        function (data) {
                            processLogin(data);
                        });
            });

            var registering = false;

            $("#newAccount").click(function () {
                if (!registering) {
                    beginRegistration();
                    registering = true;
                }
                else{
                    registerNewAccount();
                }
            });

            $("#cancel").click(function(){
                //returns display to normal
                $("#cancel").fadeOut(function(){
                    $("#login").fadeIn();
                    $("#verifyPasswordField").animate({opacity:"0"});
                });
                registering = false;
            });
        });

        function beginRegistration()
        {
            //sets up display for registration
            $("#login").fadeOut(function(){
                $("#cancel").fadeIn();
                $("#verifyPasswordField").animate({opacity:"1"});
            });

        }

		function registerNewAccount()
        {
            //do form validation here
            //check name is filled
            if ($("#usernameField").val() == ""){
                alert("A user name is required");
                return;
            }

            //check passwords match
            else if ($("#passwordField").val() !=  $("#passwordVerify").val()){
                alert("Passwords do not match");
                return;
            }
            //register new account
            else {
                $.post("php_scripts/newAccount.php",
                        {
                            userName: $("#usernameField").val(),
                            userPassword: $("#passwordField").val()
                        },
                        function (data) {
                            switch (data) {
                                case '1':
                                    //successful creation
                                    window.location = 'index.php';
                                    break;
                                case '2':
                                    //name already exists
                                    alert("Username is not available.");
                                    break;
                                default:
                                    alert("something went wrong.");
                                    break;
                            }
                        });
            }

        }

		function processLogin(key)
		{
			//uses code provided by php script to process login attempt
			switch (key)
			{
				case '1':
					//success
					window.location = 'index.php';
					break;
				case '2':
					alert("bad password yo");
					break;
				case '3':
					alert("bad user name");
					break;
				default:
					alert("There was an error connecting, try again");
					break;
			}
		}
	
	</script>
</body>
</html>